<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>القرآن الكريم MP3 | استماع وتحميل مباشر بأصوات أشهر القراء - جودة عالية</title>

    <meta name="description" content="استمع وحمل القرآن الكريم كاملاً بجودة عالية MP3. مكتبة شاملة تضم أشهر القراء (مشاري العفاسي، عبدالباسط، الحصري، المنشاوي) مع إمكانية التحميل المباشر للسور. واجهة سهلة ومتوافقة مع الجوال.">

    <meta name="keywords" content="القرآن الكريم, استماع قرآن, تحميل قرآن mp3, المصحف المرتل, مشاري العفاسي, عبدالباسط عبدالصمد, الحصري, المنشاوي, تلاوات خاشعة, القرآن الكريم كامل, quran mp3, holy quran audio">

    <meta name="robots" content="index, follow">
    <meta name="author" content="مشغل القرآن الكريم">
    
    <meta property="og:title" content="القرآن الكريم MP3 | استماع وتحميل مباشر">
    <meta property="og:description" content="منصة متكاملة للاستماع للقرآن الكريم بأصوات أشهر القراء بجودة عالية.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_AR">
    <meta property="og:site_name" content="مشغل القرآن الكريم">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="القرآن الكريم MP3 | استماع وتحميل مباشر">
    <meta name="twitter:description" content="استمع للقرآن الكريم بأفضل الأصوات وبجودة عالية.">

    <link rel="icon" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/svgs/solid/quran.svg" type="image/svg+xml">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "مشغل القرآن الكريم",
      "description": "تطبيق ويب للاستماع وتحميل القرآن الكريم بأصوات نخبة من القراء.",
      "applicationCategory": "MultimediaApplication",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary-color: #2c5f2d; --secondary-color: #97bc62; --accent-color: #f0f7da; --text-color: #333; --light-bg: #f9f9f9; --shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        body { background-color: var(--light-bg); color: var(--text-color); line-height: 1.6; background-image: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* تحسين الهيدر مع التاريخ الهجري */
        header { text-align: center; padding: 20px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; border-radius: 15px; margin-bottom: 30px; box-shadow: var(--shadow); position: relative; }
        .hijri-date { background: rgba(255, 255, 255, 0.15); padding: 8px 15px; border-radius: 50px; display: inline-block; margin-bottom: 10px; font-weight: 600; font-size: 1.1rem; backdrop-filter: blur(5px); }
        h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; }
        .basmala { font-size: 1.8rem; margin-bottom: 10px; color: #f0f7da; font-weight: 600; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; margin-bottom: 10px; }
        
        /* زر استعادة آخر جلسة */
        .restore-session { position: absolute; top: 20px; left: 20px; }
        .restore-btn { background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 8px 15px; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; display: flex; align-items: center; gap: 5px; }
        .restore-btn:hover { background: rgba(255, 255, 255, 0.3); }
        
        .main-content { display: grid; grid-template-columns: 1fr; gap: 30px; }
        @media (min-width: 992px) { .main-content { grid-template-columns: 1fr 1fr; } }
        .player-section, .reciters-section { background-color: white; border-radius: 15px; padding: 25px; box-shadow: var(--shadow); }
        .section-title { font-size: 1.8rem; color: var(--primary-color); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--secondary-color); display: flex; align-items: center; gap: 10px; }
        .section-title i { color: var(--secondary-color); }
        .player-controls { display: flex; flex-direction: column; gap: 20px; }
        .sura-selector { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color); }
        select { width: 100%; padding: 12px 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; background-color: white; transition: all 0.3s; }
        select:focus { border-color: var(--secondary-color); outline: none; }
        .audio-player { width: 100%; margin-top: 20px; border-radius: 10px; overflow: hidden; }
        audio { width: 100%; height: 50px; background-color: #f1f1f1; border-radius: 25px; }
        .custom-controls { display: flex; align-items: center; gap: 15px; margin-top: 20px; padding: 15px; background-color: var(--accent-color); border-radius: 10px; }
        .control-btn { background-color: var(--primary-color); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; transition: all 0.3s; }
        .control-btn:hover { background-color: var(--secondary-color); transform: scale(1.1); }
        .download-manual-btn { background-color: #4a6fa5; color: white; border: none; padding: 12px 25px; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; font-size: 1rem; }
        .download-manual-btn:hover { background-color: #3a5a8a; transform: translateY(-2px); }
        .progress-container { flex-grow: 1; }
        .progress-bar { width: 100%; height: 8px; background-color: #ddd; border-radius: 4px; overflow: hidden; margin-bottom: 5px; cursor: pointer; }
        .progress { height: 100%; background-color: var(--secondary-color); width: 0%; transition: width 0.1s; }
        .time-display { display: flex; justify-content: space-between; font-size: 0.9rem; color: #666; }
        .reciters-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 15px; }
        .reciter-card { background-color: var(--accent-color); border-radius: 10px; padding: 20px; transition: all 0.3s; border: 2px solid transparent; cursor: pointer; position: relative; }
        .reciter-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); }
        .reciter-card.active { border-color: var(--primary-color); background-color: #e8f5e9; }
        .reciter-name { font-weight: 700; font-size: 1.2rem; color: var(--primary-color); margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        .reciter-style { color: #666; font-size: 0.9rem; margin-bottom: 15px; }
        .reciter-actions { display: flex; gap: 10px; margin-top: 10px; }
        .action-btn { flex: 1; padding: 8px 15px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-align: center; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .select-btn { background-color: var(--primary-color); color: white; }
        .select-btn:hover { background-color: var(--secondary-color); }
        .download-btn { background-color: #f0f0f0; color: var(--text-color); border: 1px solid #ddd; text-decoration: none; }
        .download-btn:hover { background-color: #e0e0e0; }
        .current-playing { margin-top: 30px; padding: 20px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; border-radius: 10px; text-align: center; }
        .current-sura { font-size: 1.5rem; margin-bottom: 5px; }
        .current-reciter { font-size: 1.2rem; opacity: 0.9; }
        .features { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 40px; }
        .feature-card { background-color: white; border-radius: 10px; padding: 25px; text-align: center; box-shadow: var(--shadow); transition: transform 0.3s; }
        .feature-card:hover { transform: translateY(-5px); }
        .feature-icon { font-size: 2.5rem; color: var(--primary-color); margin-bottom: 15px; }
        .feature-title { font-size: 1.3rem; color: var(--primary-color); margin-bottom: 10px; }
        
        /* قسم الموارد الإسلامية */
        .resources-section { margin-top: 40px; }
        .resources-title { font-size: 2rem; color: var(--primary-color); text-align: center; margin-bottom: 30px; position: relative; padding-bottom: 15px; }
        .resources-title:after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 3px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); border-radius: 2px; }
        .resources { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .resource-card { background-color: white; border-radius: 12px; padding: 25px; box-shadow: var(--shadow); transition: all 0.3s; border-top: 4px solid var(--primary-color); display: flex; flex-direction: column; height: 100%; }
        .resource-card:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); }
        .resource-icon { font-size: 2.5rem; color: var(--primary-color); margin-bottom: 15px; text-align: center; }
        .resource-title { font-size: 1.4rem; color: var(--primary-color); margin-bottom: 10px; text-align: center; font-weight: 700; }
        .resource-desc { color: #555; line-height: 1.7; margin-bottom: 20px; flex-grow: 1; font-size: 0.95rem; }
        .resource-btn { background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 12px 20px; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-align: center; text-decoration: none; display: block; font-size: 0.95rem; }
        .resource-btn:hover { background: linear-gradient(to right, #245025, #7ca34a); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(44, 95, 45, 0.3); }
        
        footer { text-align: center; padding: 30px 0; margin-top: 50px; color: #666; border-top: 1px solid #ddd; }
        .warning { color: #d32f2f; background-color: #ffebee; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: center; font-weight: 600; }
        .loading { color: #fff; text-align: center; padding: 20px; font-size: 1.1rem; }
        .success-message { color: #2c5f2d; background-color: #e8f5e9; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center; }
        .session-info { font-size: 0.9rem; color: #666; margin-top: 10px; padding: 5px; background: rgba(255,255,255,0.1); border-radius: 5px; }
        
        /* تحسينات للخلفية */
        .background-controls { display: flex; justify-content: center; margin-top: 15px; gap: 10px; }
        .background-btn { background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; }
        
        /* تنسيقات الهيدر العلوي */
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 15px;
        }
        .logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c8a04f, #f0d58c);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            margin-right: 10px;
            text-decoration: none;
        }
        .logo i {
            font-size: 26px;
            color: white;
        }
        .page-title {
            margin: 0;
            font-size: 28px;
            direction: rtl;
            text-align: right;
            flex: 1;
            margin-right: 10px;
        }
        .hijri-date {
            font-size: 16px;
            direction: rtl;
            text-align: left;
            color: #444;
            margin-top: 45px;
            white-space: nowrap;
        }
        
        @media (max-width: 768px) { 
            h1 { font-size: 2rem; } 
            .basmala { font-size: 1.5rem; } 
            .section-title { font-size: 1.5rem; } 
            .reciters-grid { grid-template-columns: 1fr; } 
            .features { grid-template-columns: 1fr; } 
            .resources { grid-template-columns: 1fr; }
            .custom-controls { flex-wrap: wrap; justify-content: center; } 
            .download-manual-btn { width: 100%; justify-content: center; } 
            .reciter-actions { flex-direction: column; }
            .restore-session { position: static; margin-bottom: 15px; text-align: center; }
            .restore-btn { display: inline-flex; }
            .header-top { flex-direction: column; gap: 15px; }
            .hijri-date { margin-top: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header role="banner">
            <div class="restore-session">
                <button class="restore-btn" id="restore-session-btn">
                    <i class="fas fa-history"></i> استعادة آخر جلسة
                </button>
            </div>
            
            <div class="header-top">
                <a href="https://hikmavideohub-bot.github.io/Quraan/" class="logo">
                    <i class="fas fa-quran"></i>
                </a>
                <h1 class="page-title">القرآن الكريم MP3</h1>
                <div class="hijri-date" id="hijri-date">
                    <i class="fas fa-calendar-alt"></i> جارٍ تحميل التاريخ الهجري...
                </div>
            </div>
            
            <div class="basmala">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>
            <p class="subtitle">استمع وحمل القرآن الكريم كاملاً بأصوات أشهر القراء بجودة عالية</p>
            
            <div class="session-info" id="session-info" style="display: none;">
                <i class="fas fa-info-circle"></i> تم استعادة آخر جلسة: <span id="last-session"></span>
            </div>
        </header>
        
        <main class="main-content" role="main">
            <section class="player-section" aria-label="مشغل الصوت">
                <h2 class="section-title"><i class="fas fa-play-circle"></i> مشغل القرآن المباشر</h2>
                
                <div class="player-controls">
                    <div class="sura-selector">
                        <label for="sura-select"><i class="fas fa-list-ol"></i> اختر السورة للاستماع:</label>
                        <select id="sura-select" aria-label="قائمة سور القرآن">
                            </select>
                    </div>
                    
                    <div class="audio-player">
                        <audio id="quran-audio" controls preload="none">
                            متصفحك لا يدعم مشغل الصوت. يرجى استخدام متصفح حديث.
                        </audio>
                        
                        <div class="custom-controls">
                            <button class="control-btn" id="play-btn" aria-label="تشغيل">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="control-btn" id="pause-btn" aria-label="إيقاف مؤقت">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button class="control-btn" id="stop-btn" aria-label="إيقاف">
                                <i class="fas fa-stop"></i>
                            </button>
                            
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress" id="progress"></div>
                                </div>
                                <div class="time-display">
                                    <span id="current-time">0:00</span>
                                    <span id="duration">0:00</span>
                                </div>
                            </div>
                            
                            <button class="download-manual-btn" id="manual-download-btn">
                                <i class="fas fa-download"></i> تحميل MP3
                            </button>
                        </div>
                        
                        <div class="background-controls">
                            <button class="background-btn" id="enable-background-btn">
                                <i class="fas fa-play-circle"></i> تفعيل التشغيل في الخلفية
                            </button>
                            <button class="background-btn" id="save-session-btn">
                                <i class="fas fa-save"></i> حفظ الجلسة الحالية
                            </button>
                        </div>
                    </div>
                    
                    <div id="audio-test" class="success-message" style="display: none;">
                        <i class="fas fa-volume-up"></i> الصوت يعمل بشكل صحيح!
                    </div>
                </div>
                
                <div class="current-playing" id="current-playing">
                    <div class="current-sura">الفاتحة</div>
                    <div class="current-reciter">مشاري راشد العفاسي</div>
                    <div id="audio-loading" class="loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> جار تحميل الصوت...
                    </div>
                    <div id="audio-error" class="warning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i> تعذر تحميل الصوت. جرب قارئًا آخر.
                    </div>
                </div>
            </section>
            
            <section class="reciters-section" aria-label="قائمة القراء">
                <h2 class="section-title"><i class="fas fa-microphone-alt"></i> أشهر القراء (استماع وتحميل)</h2>
                <p style="margin-bottom: 20px; color: #666;">اختر من بين أشهر القراء أو حمل السورة بصوت القارئ المفضل لديك (MP3)</p>
                
                <div class="reciters-grid" id="reciters-grid">
                    </div>
                
                <div class="warning">
                    <i class="fas fa-exclamation-triangle"></i> 
                    ملاحظة: جميع الملفات الصوتية متاحة بجودة عالية وروابط مباشرة
                </div>
            </section>
        </main>
        
        
        
        <!-- قسم الموارد الإسلامية الجديد -->
        <section class="resources-section" aria-label="موارد إسلامية">
            <h2 class="resources-title"><i class="fas fa-mosque"></i> موارد إسلامية مفيدة</h2>
            
            <div class="resources">
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-quran"></i>
                    </div>
                    <h3 class="resource-title">القرآن الكريم</h3>
                    <p class="resource-desc">الاستماع إلى القرآن الكريم بصوت أي قارئ من اختيارك مع تفسير الآيات وتلاوات متعددة.</p>
                    <a href="https://hikmavideohub-bot.github.io/Quraan/" target="_blank" class="resource-btn">الذهاب إلى الموقع</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-kaaba"></i>
                    </div>
                    <h3 class="resource-title">بث مباشر الحرم المكي</h3>
                    <p class="resource-desc">مشاهدة البث المباشر للحرم المكي والمسجد النبوي وأداء الصلوات مع المصلين.</p>
                    <a href="https://youtu.be/7-Qf3g-0xEI" target="_blank" class="resource-btn">مشاهدة البث المباشر</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-tv"></i>
                    </div>
                    <h3 class="resource-title">بث مباشر قناة السنة</h3>
                    <p class="resource-desc">مشاهدة بث مباشر لقناة السنة النبوية مع برامج دينية وفتاوى وشروحات للحديث.</p>
                    <a href="https://live.tvquran.net/saudi_sunnah" target="_blank" class="resource-btn">مشاهدة القناة</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-pray"></i>
                    </div>
                    <h3 class="resource-title">حصن المسلم</h3>
                    <p class="resource-desc">كتاب حصن المسلم من أذكار الكتاب والسنة يجمع أذكار وأدعية النبي صلى الله عليه وسلم الصحيحة في مختلف مجالات الحياة اليومية.</p>
                    <a href="https://www.hisnmuslim.com/" target="_blank" class="resource-btn">تصفح الأذكار</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="resource-title">صحيح البخاري ومسلم</h3>
                    <p class="resource-desc">قراءة صحيح البخاري وصحيح مسلم كاملين مع شرح الأحاديث وتخريجها وبيان درجتها.</p>
                    <a href="https://sunnah.com" target="_blank" class="resource-btn">قراءة الأحاديث</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="resource-title">التقويم الهجري</h3>
                    <p class="resource-desc">تقويم أم القرى الرسمي مع تواريخ الأحداث الإسلامية والأعياد ومواسم العبادات.</p>
                    <a href="https://hikmavideohub-bot.github.io/hijri-date" target="_blank" class="resource-btn">عرض التقويم</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-globe-asia"></i>
                    </div>
                    <h3 class="resource-title">مواقيت الصلاة العالمية</h3>
                    <p class="resource-desc">معرفة مواقيت الصلاة في أي مدينة حول العالم مع اتجاه القبلة والأذان والتقويم الإسلامي.</p>
                    <a href="https://islamicfinder.org/world" target="_blank" class="resource-btn">معرفة المواقيت</a>
                </div>
            </div>
        </section>
        
        <section class="features" aria-label="مميزات الموقع">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-headphones-alt"></i>
                </div>
                <h3 class="feature-title">أصوات نقية</h3>
                <p>مكتبة صوتية تضم نخبة القراء بجودة عالية (MP3).</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-download"></i>
                </div>
                <h3 class="feature-title">تحميل مباشر</h3>
                <p>روابط تحميل مباشرة وسريعة لكل سور القرآن الكريم.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <h3 class="feature-title">متجاوب وسريع</h3>
                <p>يعمل بكفاءة على جميع الهواتف والأجهزة اللوحية.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-history"></i>
                </div>
                <h3 class="feature-title">حفظ الجلسات</h3>
                <p>يحفظ آخر موضع استماع ويستعيده تلقائياً عند العودة.</p>
            </div>
        </section>

        <footer>
            <p>مشغل القرآن الكريم &copy; <span id="current-year">2024</span> - صمم بحب لنشر القرآن الكريم</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">جميع الحقوق محفوظة للمواقع المزودة للتسجيلات القرآنية</p>
            <!-- p style="margin-top: 5px; font-size: 0.8rem; color: #888;">التاريخ الهجري يعمل باستخدام API من موقع hijri-date</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // حفظ سنة التاريخ
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // تعريف القراء
            const reciters = [
                { id: "mishari", name: "مشاري راشد العفاسي", style: "حدر", baseUrl: "https://server8.mp3quran.net/afs" },
                { id: "abdulbasit", name: "عبد الباسط عبد الصمد", style: "ترتيل", baseUrl: "https://server7.mp3quran.net/basit" },
                { id: "husary", name: "محمود خليل الحصري", style: "ترتيل", baseUrl: "https://server13.mp3quran.net/husr" },
                { id: "saad", name: "سعد الغامدي", style: "ترتيل", baseUrl: "https://server7.mp3quran.net/s_gmd" },
                { id: "minshawi", name: "محمد صديق المنشاوي", style: "تجويد", baseUrl: "https://server10.mp3quran.net/minsh" },
                { id: "basfar", name: "عبد الله بصفر", style: "ترتيل", baseUrl: "https://server6.mp3quran.net/bsfr" }
            ];
            
            // تعريف السور
            const suras = [
                { number: 1, name: "الفاتحة" }, { number: 2, name: "البقرة" }, { number: 3, name: "آل عمران" }, { number: 4, name: "النساء" }, { number: 5, name: "المائدة" }, { number: 6, name: "الأنعام" }, { number: 7, name: "الأعراف" }, { number: 8, name: "الأنفال" }, { number: 9, name: "التوبة" }, { number: 10, name: "يونس" }, { number: 11, name: "هود" }, { number: 12, name: "يوسف" }, { number: 13, name: "الرعد" }, { number: 14, name: "إبراهيم" }, { number: 15, name: "الحجر" }, { number: 16, name: "النحل" }, { number: 17, name: "الإسراء" }, { number: 18, name: "الكهف" }, { number: 19, name: "مريم" }, { number: 20, name: "طه" }, { number: 21, name: "الأنبياء" }, { number: 22, name: "الحج" }, { number: 23, name: "المؤمنون" }, { number: 24, name: "النور" }, { number: 25, name: "الفرقان" }, { number: 26, name: "الشعراء" }, { number: 27, name: "النمل" }, { number: 28, name: "القصص" }, { number: 29, name: "العنكبوت" }, { number: 30, name: "الروم" }, { number: 31, name: "لقمان" }, { number: 32, name: "السجدة" }, { number: 33, name: "الأحزاب" }, { number: 34, name: "سبأ" }, { number: 35, name: "فاطر" }, { number: 36, name: "يس" }, { number: 37, name: "الصافات" }, { number: 38, name: "ص" }, { number: 39, name: "الزمر" }, { number: 40, name: "غافر" }, { number: 41, name: "فصلت" }, { number: 42, name: "الشورى" }, { number: 43, name: "الزخرف" }, { number: 44, name: "الدخان" }, { number: 45, name: "الجاثية" }, { number: 46, name: "الأحقاف" }, { number: 47, name: "محمد" }, { number: 48, name: "الفتح" }, { number: 49, name: "الحجرات" }, { number: 50, name: "ق" }, { number: 51, name: "الذاريات" }, { number: 52, name: "الطور" }, { number: 53, name: "النجم" }, { number: 54, name: "القمر" }, { number: 55, name: "الرحمن" }, { number: 56, name: "الواقعة" }, { number: 57, name: "الحديد" }, { number: 58, name: "المجادلة" }, { number: 59, name: "الحشر" }, { number: 60, name: "الممتحنة" }, { number: 61, name: "الصف" }, { number: 62, name: "الجمعة" }, { number: 63, name: "المنافقون" }, { number: 64, name: "التغابن" }, { number: 65, name: "الطلاق" }, { number: 66, name: "التحريم" }, { number: 67, name: "الملك" }, { number: 68, name: "القلم" }, { number: 69, name: "الحاقة" }, { number: 70, name: "المعارج" }, { number: 71, name: "نوح" }, { number: 72, name: "الجن" }, { number: 73, name: "المزمل" }, { number: 74, name: "المدثر" }, { number: 75, name: "القيامة" }, { number: 76, name: "الإنسان" }, { number: 77, name: "المرسلات" }, { number: 78, name: "النبأ" }, { number: 79, name: "النازعات" }, { number: 80, name: "عبس" }, { number: 81, name: "التكوير" }, { number: 82, name: "الانفطار" }, { number: 83, name: "المطففين" }, { number: 84, name: "الانشقاق" }, { number: 85, name: "البروج" }, { number: 86, name: "الطارق" }, { number: 87, name: "الأعلى" }, { number: 88, name: "الغاشية" }, { number: 89, name: "الفجر" }, { number: 90, name: "البلد" }, { number: 91, name: "الشمس" }, { number: 92, name: "الليل" }, { number: 93, name: "الضحى" }, { number: 94, name: "الشرح" }, { number: 95, name: "التين" }, { number: 96, name: "العلق" }, { number: 97, name: "القدر" }, { number: 98, name: "البينة" }, { number: 99, name: "الزلزلة" }, { number: 100, name: "العاديات" }, { number: 101, name: "القارعة" }, { number: 102, name: "التكاثر" }, { number: 103, name: "العصر" }, { number: 104, name: "الهمزة" }, { number: 105, name: "الفيل" }, { number: 106, name: "قريش" }, { number: 107, name: "الماعون" }, { number: 108, name: "الكوثر" }, { number: 109, name: "الكافرون" }, { number: 110, name: "النصر" }, { number: 111, name: "المسد" }, { number: 112, name: "الإخلاص" }, { number: 113, name: "الفلق" }, { number: 114, name: "الناس" }
            ];
            
            // تعريف المتغيرات
            const audioPlayer = document.getElementById('quran-audio');
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const stopBtn = document.getElementById('stop-btn');
            const manualDownloadBtn = document.getElementById('manual-download-btn');
            const progressBar = document.getElementById('progress');
            const currentTimeDisplay = document.getElementById('current-time');
            const durationDisplay = document.getElementById('duration');
            const suraSelect = document.getElementById('sura-select');
            const recitersGrid = document.getElementById('reciters-grid');
            const currentPlayingElement = document.getElementById('current-playing');
            const audioLoadingElement = document.getElementById('audio-loading');
            const audioErrorElement = document.getElementById('audio-error');
            const audioTestElement = document.getElementById('audio-test');
            const restoreSessionBtn = document.getElementById('restore-session-btn');
            const saveSessionBtn = document.getElementById('save-session-btn');
            const enableBackgroundBtn = document.getElementById('enable-background-btn');
            const hijriDateElement = document.getElementById('hijri-date');
            const sessionInfoElement = document.getElementById('session-info');
            const lastSessionElement = document.getElementById('last-session');
            
            let currentReciter = reciters[0];
            let currentSura = suras[0];
            let audioUrl = '';
            let shouldRestoreSession = true;
            
            // دالة تحميل التاريخ الهجري
            async function loadHijriDate() {
                try {
                    const response = await fetch('https://hikmavideohub-bot.github.io/hijri-date/api');
                    if (response.ok) {
                        const data = await response.json();
                        hijriDateElement.innerHTML = `<a href="https://hikmavideohub-bot.github.io/hijri-date/" target="_blank" style="text-decoration:none;color:inherit;cursor:pointer;"><i class="fas fa-calendar-alt"></i> ${data.hijri}</a>`;
                    } else {
                        throw new Error('API failed');
                    }
                } catch (error) {
                    const today = new Date();
                    const options = { day: 'numeric', month: 'long', year: 'numeric', calendar: 'islamic' };
                    const hijriDate = new Intl.DateTimeFormat('ar-u-ca-islamic', options).format(today);
                    hijriDateElement.innerHTML = `<a href="https://hikmavideohub-bot.github.io/hijri-date/" target="_blank" style="text-decoration:none;color:inherit;cursor:pointer;"><i class="fas fa-calendar-alt"></i> ${hijriDate}</a>`;
                }
            }
            
            // دالة حفظ الجلسة الحالية
            function saveCurrentSession() {
                const sessionData = {
                    reciterId: currentReciter.id,
                    suraNumber: currentSura.number,
                    currentTime: audioPlayer.currentTime || 0,
                    timestamp: Date.now(),
                    isPlaying: !audioPlayer.paused
                };
                
                localStorage.setItem('quranPlayerSession', JSON.stringify(sessionData));
                
                // إظهار رسالة نجاح
                showMessage('تم حفظ الجلسة الحالية بنجاح', 'success');
            }
            
            // دالة استعادة الجلسة السابقة
            function restoreLastSession() {
                const savedSession = localStorage.getItem('quranPlayerSession');
                
                if (savedSession) {
                    const sessionData = JSON.parse(savedSession);
                    
                    // استعادة القارئ
                    const savedReciter = reciters.find(r => r.id === sessionData.reciterId);
                    if (savedReciter) {
                        currentReciter = savedReciter;
                    }
                    
                    // استعادة السورة
                    const savedSura = suras.find(s => s.number === sessionData.suraNumber);
                    if (savedSura) {
                        currentSura = savedSura;
                    }
                    
                    // تحديث الواجهة
                    suraSelect.value = currentSura.number;
                    createReciterCards();
                    updateAudioSource(false);
                    
                    // عرض معلومات الجلسة المستعادة
                    lastSessionElement.textContent = `${currentSura.name} - ${currentReciter.name}`;
                    sessionInfoElement.style.display = 'block';
                    
                    // استعادة وقت التشغيل بعد تحميل الصوت
                    audioPlayer.addEventListener('loadedmetadata', function restoreTime() {
                        if (sessionData.currentTime && sessionData.currentTime > 0) {
                            audioPlayer.currentTime = sessionData.currentTime;
                            
                            // إذا كانت الجلسة السابقة كانت قيد التشغيل، ابدأ التشغيل
                            if (sessionData.isPlaying && shouldRestoreSession) {
                                setTimeout(() => {
                                    audioPlayer.play().catch(e => console.log("التشغيل التلقائي غير مدعوم"));
                                }, 500);
                            }
                        }
                        audioPlayer.removeEventListener('loadedmetadata', restoreTime);
                    });
                    
                    showMessage('تم استعادة آخر جلسة بنجاح', 'success');
                } else {
                    showMessage('لا توجد جلسة سابقة محفوظة', 'info');
                }
            }
            
            // دالة إظهار الرسائل
            function showMessage(message, type = 'info') {
                const messageDiv = document.createElement('div');
                messageDiv.className = type === 'success' ? 'success-message' : 'warning';
                messageDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
                messageDiv.style.position = 'fixed';
                messageDiv.style.top = '20px';
                messageDiv.style.left = '50%';
                messageDiv.style.transform = 'translateX(-50%)';
                messageDiv.style.zIndex = '1000';
                messageDiv.style.minWidth = '300px';
                messageDiv.style.textAlign = 'center';
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            }
            
            // تهيئة الواجهة
            function initializeUI() {
                audioErrorElement.style.display = 'none';
                audioTestElement.style.display = 'none';
                
                // تعبئة قائمة السور
                suraSelect.innerHTML = '';
                suras.forEach(sura => {
                    const option = document.createElement('option');
                    option.value = sura.number;
                    option.textContent = `${sura.number}. ${sura.name}`;
                    suraSelect.appendChild(option);
                });
                
                // محاولة استعادة الجلسة السابقة تلقائياً
                const savedSession = localStorage.getItem('quranPlayerSession');
                if (savedSession && shouldRestoreSession) {
                    restoreLastSession();
                } else {
                    // استخدام القيم الافتراضية
                    suraSelect.value = currentSura.number;
                    createReciterCards();
                    updateAudioSource(false);
                }
            }
            
            // إنشاء بطاقات القراء
            function createReciterCards() {
                recitersGrid.innerHTML = '';
                
                reciters.forEach(reciter => {
                    const card = document.createElement('div');
                    card.className = 'reciter-card';
                    if (reciter.id === currentReciter.id) {
                        card.classList.add('active');
                    }
                    
                    const suraNumberFormatted = currentSura.number.toString().padStart(3, '0');
                    const downloadUrl = `${reciter.baseUrl}/${suraNumberFormatted}.mp3`;
                    const downloadFileName = `${currentSura.name}-${reciter.name}.mp3`;
                    
                    card.innerHTML = `
                        <div class="reciter-name">
                            <span>${reciter.name}</span>
                            ${reciter.id === currentReciter.id ? '<span style="font-size:0.8rem; color: var(--secondary-color);"><i class="fas fa-check-circle"></i> قيد التشغيل</span>' : ''}
                        </div>
                        <div class="reciter-style">${reciter.style}</div>
                        <div class="reciter-actions">
                            <button class="action-btn select-btn" data-reciter="${reciter.id}" aria-label="تشغيل بصوت ${reciter.name}">
                                <i class="fas fa-play-circle"></i> تشغيل
                            </button>
                            <a href="${downloadUrl}" download="${downloadFileName}" class="action-btn download-btn" aria-label="تحميل بصوت ${reciter.name}">
                                <i class="fas fa-download"></i> تحميل
                            </a>
                        </div>
                    `;
                    
                    recitersGrid.appendChild(card);
                });
                
                // إضافة مستمعين الأحداث
                document.querySelectorAll('.select-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const reciterId = this.getAttribute('data-reciter');
                        selectReciter(reciterId);
                    });
                });
            }
            
            // تحديث روابط التحميل
            function updateDownloadLinks() {
                const suraNumberFormatted = currentSura.number.toString().padStart(3, '0');
                
                document.querySelectorAll('.download-btn').forEach((link, index) => {
                    const reciter = reciters[index];
                    const downloadUrl = `${reciter.baseUrl}/${suraNumberFormatted}.mp3`;
                    const downloadFileName = `${currentSura.name}-${reciter.name}.mp3`;
                    
                    link.href = downloadUrl;
                    link.download = downloadFileName;
                });
            }
            
            // تحديث مصدر الصوت
            function updateAudioSource(shouldPlay = true) {
                audioLoadingElement.style.display = 'block';
                audioErrorElement.style.display = 'none';
                audioTestElement.style.display = 'none';
                
                const suraNumberFormatted = currentSura.number.toString().padStart(3, '0');
                audioUrl = `${currentReciter.baseUrl}/${suraNumberFormatted}.mp3`;
                
                currentPlayingElement.innerHTML = `
                    <div class="current-sura">${currentSura.number}. ${currentSura.name}</div>
                    <div class="current-reciter">${currentReciter.name}</div>
                    <div id="audio-loading" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> جار تحميل الصوت...
                    </div>
                    <div id="audio-error" class="warning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i> تعذر تحميل الصوت. جرب قارئًا آخر.
                    </div>
                `;
                
                audioPlayer.src = audioUrl;
                audioPlayer.load();
                
                progressBar.style.width = '0%';
                currentTimeDisplay.textContent = '0:00';
                durationDisplay.textContent = '0:00';
                
                audioPlayer.addEventListener('canplay', function onCanPlay() {
                    audioLoadingElement.style.display = 'none';
                    audioTestElement.style.display = 'block';
                    
                    currentPlayingElement.innerHTML = `
                        <div class="current-sura">${currentSura.number}. ${currentSura.name}</div>
                        <div class="current-reciter">${currentReciter.name}</div>
                        <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                            <i class="fas fa-check-circle"></i> جاهز للاستماع
                        </div>
                    `;
                    
                    if (shouldPlay) {
                        audioPlayer.play().catch(error => {
                            console.log("التشغيل التلقائي غير مدعوم. استخدم زر التشغيل.");
                            audioTestElement.innerHTML = '<i class="fas fa-info-circle"></i> اضغط على زر التشغيل (▶️) للاستماع';
                        });
                    }
                    
                    audioPlayer.removeEventListener('canplay', onCanPlay);
                }, { once: true });
                
                audioPlayer.addEventListener('error', function onError(e) {
                    audioLoadingElement.style.display = 'none';
                    audioErrorElement.style.display = 'block';
                    audioTestElement.style.display = 'none';
                    audioPlayer.removeEventListener('error', onError);
                }, { once: true });
                
                updateDownloadLinks();
            }
            
            // تحميل الصوت
            function downloadAudio() {
                if (!audioUrl) return;
                
                const link = document.createElement('a');
                link.href = audioUrl;
                link.download = `${currentSura.name}-${currentReciter.name}.mp3`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // اختيار سورة
            function selectSura(suraNumber) {
                currentSura = suras.find(s => s.number === suraNumber);
                suraSelect.value = suraNumber;
                updateAudioSource(true);
            }
            
            // اختيار قارئ
            function selectReciter(reciterId) {
                currentReciter = reciters.find(r => r.id === reciterId);
                
                document.querySelectorAll('.reciter-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                document.querySelectorAll('.reciter-card').forEach((card, index) => {
                    if (reciters[index].id === reciterId) {
                        card.classList.add('active');
                    }
                });
                
                updateAudioSource(true);
            }
            
            // تحديث شريط التقدم
            function updateProgress() {
                if (audioPlayer.duration && !isNaN(audioPlayer.duration)) {
                    const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                    progressBar.style.width = `${percent}%`;
                    currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
                    durationDisplay.textContent = formatTime(audioPlayer.duration);
                    
                    // حفظ التقدم كل 10 ثوانٍ
                    if (Math.floor(audioPlayer.currentTime) % 10 === 0) {
                        saveCurrentSession();
                    }
                }
            }
            
            // تنسيق الوقت
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }
            
            // تمكين التشغيل في الخلفية
            function enableBackgroundPlayback() {
                if ('serviceWorker' in navigator && 'Notification' in window) {
                    navigator.serviceWorker.register('/sw.js').then(() => {
                        showMessage('تم تفعيل التشغيل في الخلفية', 'success');
                        enableBackgroundBtn.innerHTML = '<i class="fas fa-check-circle"></i> التشغيل في الخلفية مفعل';
                        enableBackgroundBtn.disabled = true;
                    }).catch(err => {
                        showMessage('تعذر تفعيل التشغيل في الخلفية', 'warning');
                    });
                } else {
                    showMessage('المتصفح لا يدعم التشغيل في الخلفية', 'warning');
                }
            }
            
            // إضافة مستمعي الأحداث
            suraSelect.addEventListener('change', function() {
                selectSura(parseInt(this.value));
            });
            
            playBtn.addEventListener('click', function() {
                audioPlayer.play().catch(e => {
                    console.log("فشل التشغيل");
                });
            });
            
            pauseBtn.addEventListener('click', function() {
                audioPlayer.pause();
            });
            
            stopBtn.addEventListener('click', function() {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                progressBar.style.width = '0%';
                currentTimeDisplay.textContent = '0:00';
            });
            
            manualDownloadBtn.addEventListener('click', function() {
                downloadAudio();
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-check"></i> تم بدء التحميل';
                this.style.backgroundColor = '#2c5f2d';
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.style.backgroundColor = '#4a6fa5';
                }, 2000);
            });
            
            restoreSessionBtn.addEventListener('click', function() {
                restoreLastSession();
            });
            
            saveSessionBtn.addEventListener('click', function() {
                saveCurrentSession();
            });
            
            enableBackgroundBtn.addEventListener('click', function() {
                enableBackgroundPlayback();
            });
            
            audioPlayer.addEventListener('timeupdate', updateProgress);
            
            audioPlayer.addEventListener('loadedmetadata', function() {
                if (audioPlayer.duration && !isNaN(audioPlayer.duration)) {
                    durationDisplay.textContent = formatTime(audioPlayer.duration);
                }
            });
            
            // النقر على شريط التقدم للانتقال
            const progressContainer = document.querySelector('.progress-bar');
            progressContainer.addEventListener('click', function(e) {
                if (audioPlayer.duration && !isNaN(audioPlayer.duration)) {
                    const width = this.clientWidth;
                    const clickX = e.offsetX;
                    const duration = audioPlayer.duration;
                    audioPlayer.currentTime = (clickX / width) * duration;
                }
            });
            
            // حفظ الجلسة عند مغادرة الصفحة
            window.addEventListener('beforeunload', function() {
                saveCurrentSession();
            });
            
            // حفظ الجلسة كل دقيقة
            setInterval(saveCurrentSession, 60000);
            
            // تشغيل التهيئة
            initializeUI();
            loadHijriDate();
        });
    </script>
</body>
</html>
